import React, { useState } from 'react';
import {
  Box,
  Container,
  Typography,
  Paper,
  Grid,
  Button,
  Card,
  CardContent,
  CardActions,
  Chip,
  Stack,
  Divider,
  useTheme,
  alpha
} from '@mui/material';
import {
  VolumeUp,
  PlayArrow,
  Home,
  CameraAlt,
  VerifiedUser,
  HowToVote,
  Security,
  ThumbUp
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import VoiceControl from '../Components/VoiceControl';
import useVoiceNarration from '../hooks/useVoiceNarration';

const MotionCard = motion(Card);

const VoiceDemo = () => {
  const theme = useTheme();
  const [currentStep, setCurrentStep] = useState('landing');
  const { playVoiceGuide, isPlaying, isEnabled, hasPlayedOnce, resetPlayedAudio } = useVoiceNarration();

  // Indian flag colors
  const saffron = '#FF9933';
  const white = '#FFFFFF';
  const green = '#138808';
  const navy = '#000080';

  const voiceSteps = [
    {
      id: 'landing',
      title: 'Landing Page',
      titleHindi: 'рдореБрдЦреНрдп рдкреГрд╖реНрда',
      icon: <Home sx={{ fontSize: 40 }} />,
      description: 'Welcome message and system introduction',
      descriptionHindi: 'рд╕реНрд╡рд╛рдЧрдд рд╕рдВрджреЗрд╢ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдкрд░рд┐рдЪрдп',
      audioFile: 'step1_landing.mp3',
      content: 'Welcome to the E-Voting System. Please click on Election to cast a vote. рдИ-рд╡реЛрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИред рд╡реЛрдЯ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП Election рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред'
    },
    {
      id: 'camera',
      title: 'Camera Recognition',
      titleHindi: 'рдХреИрдорд░рд╛ рдкрд╣рдЪрд╛рди',
      icon: <CameraAlt sx={{ fontSize: 40 }} />,
      description: 'Face recognition camera instructions',
      descriptionHindi: 'рдЪреЗрд╣рд░рд╛ рдкрд╣рдЪрд╛рди рдХреИрдорд░рд╛ рдирд┐рд░реНрджреЗрд╢',
      audioFile: 'step2_camera.mp3',
      content: 'Please look at the camera. рдХреГрдкрдпрд╛ рдХреИрдорд░реЗ рдХреА рдУрд░ рджреЗрдЦреЗрдВред'
    },
    {
      id: 'confirm',
      title: 'Identity Confirmation',
      titleHindi: 'рдкрд╣рдЪрд╛рди рдкреБрд╖реНрдЯрд┐',
      icon: <VerifiedUser sx={{ fontSize: 40 }} />,
      description: 'Confirm recognized identity',
      descriptionHindi: 'рдкрд╣рдЪрд╛рдиреА рдЧрдИ рдкрд╣рдЪрд╛рди рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВ',
      audioFile: 'step3_confirm.mp3',
      content: 'Confirm your identity by clicking Confirm or Not Me. рдХреГрдкрдпрд╛ Confirm рдпрд╛ Not Me рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдХреЗ рдЕрдкрдиреА рдкрд╣рдЪрд╛рди рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВред'
    },
    {
      id: 'vote',
      title: 'Voting Process',
      titleHindi: 'рдорддрджрд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛',
      icon: <HowToVote sx={{ fontSize: 40 }} />,
      description: 'Cast vote for preferred candidate',
      descriptionHindi: 'рдкрд╕рдВрджреАрджрд╛ рдЙрдореНрдореАрджрд╡рд╛рд░ рдХреЛ рд╡реЛрдЯ рджреЗрдВ',
      audioFile: 'step4_vote.mp3',
      content: 'Cast your vote for your preferred candidate in this election. For casting a vote, click on the Vote button. рдЕрдкрдиреЗ рдкрд╕рдВрджреАрджрд╛ рдЙрдореНрдореАрджрд╡рд╛рд░ рдХреЛ рд╡реЛрдЯ рджреЗрдВред рд╡реЛрдЯ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП Vote рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред'
    },
    {
      id: 'verify',
      title: 'Vote Verification',
      titleHindi: 'рд╡реЛрдЯ рд╕рддреНрдпрд╛рдкрди',
      icon: <Security sx={{ fontSize: 40 }} />,
      description: 'Secure voting authentication',
      descriptionHindi: 'рд╕реБрд░рдХреНрд╖рд┐рдд рдорддрджрд╛рди рдкреНрд░рдорд╛рдгреАрдХрд░рдг',
      audioFile: 'step5_verify.mp3',
      content: 'Please Click on the Vote Button for Secure Voting. рдХреГрдкрдпрд╛ Vote рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдХреЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд╡реЛрдЯ рджреЗрдВред'
    },
    {
      id: 'thankyou',
      title: 'Thank You',
      titleHindi: 'рдзрдиреНрдпрд╡рд╛рдж',
      icon: <ThumbUp sx={{ fontSize: 40 }} />,
      description: 'Vote confirmation and thanks',
      descriptionHindi: 'рд╡реЛрдЯ рдкреБрд╖реНрдЯрд┐ рдФрд░ рдзрдиреНрдпрд╡рд╛рдж',
      audioFile: 'step6_thankyou.mp3',
      content: 'Please confirm to cast your vote. Thank you. рд╡реЛрдЯ рдбрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХреГрдкрдпрд╛ рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВред рдзрдиреНрдпрд╡рд╛рджред'
    }
  ];

  const handleStepChange = (stepId) => {
    setCurrentStep(stepId);
    playVoiceGuide(stepId);
  };

  const currentStepData = voiceSteps.find(step => step.id === currentStep);

  return (
    <Box sx={{ 
      minHeight: '100vh',
      backgroundColor: '#f8f9fa'
    }}>
      {/* Header */}
      <Box sx={{ 
        background: `linear-gradient(90deg, ${saffron} 0%, ${white} 50%, ${green} 100%)`,
        height: '6px'
      }} />
      
      <Box sx={{ 
        backgroundColor: navy,
        color: white,
        py: 3,
        textAlign: 'center'
      }}>
        <Container maxWidth="lg">
          <Typography variant="h4" fontWeight="bold" gutterBottom>
            ЁЯО╡ Voice Narration Demo
          </Typography>
          <Typography variant="h5" fontWeight="bold">
            рдЖрд╡рд╛рдЬрд╝ рдЧрд╛рдЗрдб рдбреЗрдореЛ | Voice Guide Demo
          </Typography>
          <Typography variant="body1" sx={{ opacity: 0.9, mt: 1 }}>
            E-Voting System Audio Guidance | рдИ-рд╡реЛрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдСрдбрд┐рдпреЛ рдорд╛рд░реНрдЧрджрд░реНрд╢рди
          </Typography>
        </Container>
      </Box>

      <Container maxWidth="xl" sx={{ py: 4 }}>
        {/* Current Step Display */}
        <Paper sx={{ 
          p: 4, 
          mb: 4,
          background: `linear-gradient(135deg, ${alpha(saffron, 0.1)} 0%, ${alpha(green, 0.1)} 100%)`,
          border: `2px solid ${alpha(navy, 0.2)}`,
          borderRadius: 3
        }}>
          <Box sx={{ textAlign: 'center', mb: 3 }}>
            <Box sx={{ 
              display: 'flex', 
              justifyContent: 'center', 
              mb: 2,
              color: navy
            }}>
              {currentStepData?.icon}
            </Box>
            <Typography variant="h4" fontWeight="bold" sx={{ color: navy, mb: 1 }}>
              {currentStepData?.titleHindi}
            </Typography>
            <Typography variant="h5" fontWeight="bold" sx={{ color: green, mb: 2 }}>
              {currentStepData?.title}
            </Typography>
            <Typography variant="body1" sx={{ color: 'text.secondary', mb: 3, maxWidth: 800, mx: 'auto' }}>
              {currentStepData?.descriptionHindi} | {currentStepData?.description}
            </Typography>
            
            {/* Voice Control for Current Step */}
            <VoiceControl 
              step={currentStep} 
              autoPlay={false} 
              variant="inline" 
              showLabel={true}
            />
          </Box>

          {/* Audio Content Display */}
          <Paper sx={{ 
            p: 3, 
            backgroundColor: white,
            border: `1px solid ${alpha(saffron, 0.3)}`,
            borderRadius: 2
          }}>
            <Typography variant="h6" fontWeight="bold" sx={{ color: navy, mb: 2 }}>
              ЁЯУЭ Audio Content | рдСрдбрд┐рдпреЛ рд╕рд╛рдордЧреНрд░реА
            </Typography>
            <Typography variant="body1" sx={{ 
              lineHeight: 1.8,
              fontSize: '1.1rem',
              color: 'text.primary'
            }}>
              {currentStepData?.content}
            </Typography>
            <Box sx={{ mt: 2, display: 'flex', alignItems: 'center', gap: 1 }}>
              <Chip 
                label={`ЁЯО╡ ${currentStepData?.audioFile}`}
                size="small"
                sx={{ 
                  backgroundColor: alpha(green, 0.1),
                  color: green,
                  fontWeight: 'bold'
                }}
              />
              <Chip 
                label={isEnabled ? "ЁЯФК Voice Enabled" : "ЁЯФЗ Voice Disabled"}
                size="small"
                sx={{ 
                  backgroundColor: isEnabled ? alpha(saffron, 0.1) : alpha('#666', 0.1),
                  color: isEnabled ? saffron : '#666',
                  fontWeight: 'bold'
                }}
              />
              {isPlaying && (
                <Chip 
                  label="тЦ╢я╕П Playing"
                  size="small"
                  sx={{ 
                    backgroundColor: alpha('#4caf50', 0.1),
                    color: '#4caf50',
                    fontWeight: 'bold',
                    animation: 'pulse 2s infinite',
                    '@keyframes pulse': {
                      '0%': { opacity: 1 },
                      '50%': { opacity: 0.7 },
                      '100%': { opacity: 1 }
                    }
                  }}
                />
              )}
              {hasPlayedOnce.includes(currentStep) && (
                <Chip 
                  label="тЬЕ Played Once"
                  size="small"
                  sx={{ 
                    backgroundColor: alpha(theme.palette.info.main, 0.1),
                    color: theme.palette.info.main,
                    fontWeight: 'bold'
                  }}
                />
              )}
            </Box>
            
            {/* Reset Button for Testing */}
            <Box sx={{ mt: 2, textAlign: 'center' }}>
              <Button
                variant="outlined"
                size="small"
                onClick={resetPlayedAudio}
                sx={{
                  borderColor: '#ff6b6b',
                  color: '#ff6b6b',
                  '&:hover': {
                    borderColor: '#ff6b6b',
                    backgroundColor: alpha('#ff6b6b', 0.1)
                  }
                }}
              >
                ЁЯФД Reset Played Status | рд╕реНрдерд┐рддрд┐ рд░реАрд╕реЗрдЯ рдХрд░реЗрдВ
              </Button>
            </Box>
          </Paper>
        </Paper>

        {/* Step Selection Grid */}
        <Typography variant="h5" fontWeight="bold" sx={{ color: navy, mb: 3, textAlign: 'center' }}>
          ЁЯОп Select Voting Step | рдЪрд░рдг рдЪреБрдиреЗрдВ
        </Typography>
        
        <Grid container spacing={3}>
          {voiceSteps.map((step, index) => (
            <Grid item xs={12} sm={6} md={4} key={step.id}>
              <MotionCard
                sx={{ 
                  height: '100%',
                  cursor: 'pointer',
                  borderRadius: 3,
                  boxShadow: '0 4px 20px rgba(0,0,0,0.08)',
                  border: currentStep === step.id ? `3px solid ${saffron}` : `2px solid ${alpha(navy, 0.1)}`,
                  transition: 'all 0.3s ease',
                  '&:hover': {
                    transform: 'translateY(-5px)',
                    boxShadow: '0 8px 25px rgba(0,0,0,0.12)',
                    borderColor: saffron
                  },
                  position: 'relative'
                }}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5, delay: index * 0.1 }}
                onClick={() => handleStepChange(step.id)}
              >
                {/* Played Once Indicator */}
                {hasPlayedOnce.includes(step.id) && (
                  <Box sx={{
                    position: 'absolute',
                    top: 8,
                    right: 8,
                    backgroundColor: theme.palette.success.main,
                    color: 'white',
                    borderRadius: '50%',
                    width: 24,
                    height: 24,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '12px',
                    fontWeight: 'bold',
                    zIndex: 1
                  }}>
                    тЬУ
                  </Box>
                )}
                
                <CardContent sx={{ p: 3, textAlign: 'center' }}>
                  <Box sx={{ 
                    display: 'flex', 
                    justifyContent: 'center', 
                    mb: 2,
                    color: currentStep === step.id ? saffron : navy
                  }}>
                    {step.icon}
                  </Box>
                  <Typography variant="h6" fontWeight="bold" sx={{ color: navy, mb: 1 }}>
                    {step.titleHindi}
                  </Typography>
                  <Typography variant="h6" fontWeight="bold" sx={{ color: green, mb: 2 }}>
                    {step.title}
                  </Typography>
                  <Typography variant="body2" color="text.secondary" sx={{ lineHeight: 1.6 }}>
                    {step.descriptionHindi}
                  </Typography>
                  <Typography variant="body2" color="text.secondary" sx={{ lineHeight: 1.6 }}>
                    {step.description}
                  </Typography>
                </CardContent>
                <CardActions sx={{ justifyContent: 'center', pb: 2 }}>
                  <Button
                    variant={currentStep === step.id ? "contained" : "outlined"}
                    startIcon={<PlayArrow />}
                    sx={{
                      backgroundColor: currentStep === step.id ? saffron : 'transparent',
                      borderColor: currentStep === step.id ? saffron : navy,
                      color: currentStep === step.id ? white : navy,
                      '&:hover': {
                        backgroundColor: currentStep === step.id ? alpha(saffron, 0.8) : alpha(saffron, 0.1),
                        borderColor: saffron
                      }
                    }}
                  >
                    Play Audio
                  </Button>
                </CardActions>
              </MotionCard>
            </Grid>
          ))}
        </Grid>

        {/* Features Section */}
        <Box sx={{ mt: 6 }}>
          <Typography variant="h5" fontWeight="bold" sx={{ color: navy, mb: 3, textAlign: 'center' }}>
            ЁЯМЯ Voice Narration Features | рдЖрд╡рд╛рдЬрд╝ рдЧрд╛рдЗрдб рд╕реБрд╡рд┐рдзрд╛рдПрдВ
          </Typography>
          
          <Grid container spacing={3}>
            <Grid item xs={12} md={4}>
              <Paper sx={{ p: 3, textAlign: 'center', height: '100%' }}>
                <VolumeUp sx={{ fontSize: 48, color: saffron, mb: 2 }} />
                <Typography variant="h6" fontWeight="bold" sx={{ color: navy, mb: 1 }}>
                  Bilingual Support
                </Typography>
                <Typography variant="h6" fontWeight="bold" sx={{ color: green, mb: 2 }}>
                  рджреНрд╡рд┐рднрд╛рд╖реА рд╕рдорд░реНрдерди
                </Typography>
                <Typography variant="body2" color="text.secondary">
                  Hindi and English voice guidance for all voting steps
                </Typography>
              </Paper>
            </Grid>
            
            <Grid item xs={12} md={4}>
              <Paper sx={{ p: 3, textAlign: 'center', height: '100%' }}>
                <Security sx={{ fontSize: 48, color: green, mb: 2 }} />
                <Typography variant="h6" fontWeight="bold" sx={{ color: navy, mb: 1 }}>
                  Accessibility
                </Typography>
                <Typography variant="h6" fontWeight="bold" sx={{ color: green, mb: 2 }}>
                  рдкрд╣реБрдВрдЪ рдпреЛрдЧреНрдпрддрд╛
                </Typography>
                <Typography variant="body2" color="text.secondary">
                  Helps visually impaired and elderly voters navigate the system
                </Typography>
              </Paper>
            </Grid>
            
            <Grid item xs={12} md={4}>
              <Paper sx={{ p: 3, textAlign: 'center', height: '100%' }}>
                <VerifiedUser sx={{ fontSize: 48, color: navy, mb: 2 }} />
                <Typography variant="h6" fontWeight="bold" sx={{ color: navy, mb: 1 }}>
                  User Control
                </Typography>
                <Typography variant="h6" fontWeight="bold" sx={{ color: green, mb: 2 }}>
                  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рдпрдВрддреНрд░рдг
                </Typography>
                <Typography variant="body2" color="text.secondary">
                  Play, pause, replay, and toggle voice narration as needed
                </Typography>
              </Paper>
            </Grid>
          </Grid>
        </Box>
      </Container>

      {/* Floating Voice Control */}
      <VoiceControl 
        step={currentStep} 
        autoPlay={false} 
        variant="floating" 
        showLabel={true}
      />
    </Box>
  );
};

export default VoiceDemo; 